services:
  hls-proxy:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: hls-proxy-build
    environment:
      - HOST=0.0.0.0
      - PORT=1323
      - PREFETCH=true
      - SEGMENTS=30
      - SEGMENT_STORE=true
      - SEGMENT_STORAGE_DIR=/app/segments
      - SEGMENT_CACHE=false
      - THROTTLE=5
      - JANITOR_INTERVAL=20s
      - ATTEMPTS=3
      - CLIP_RETENTION=30m
      - PLAYLIST_RETENTION=5h
      - LOG_LEVEL=INFO
      - HTTP_CLIENT_TIMEOUT=60s
      - HTTP_DIAL_TIMEOUT=15s
      - HTTP_RETRY_REQUEST_DELAY=3s
      - HTTP_RETRY_CLIP_DELAY=2s
    ports:
      - "1323:1323"
    restart: unless-stopped
    volumes:
      - ./segments:/app/segments
    healthcheck:
      test: ["CMD", "/app/hls-proxy", "--healthcheck"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 15s

networks:
  default:
    name: hls-proxy-net
